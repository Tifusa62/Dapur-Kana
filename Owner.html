<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Owner - Dapur Kana</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body { font-family: sans-serif; padding: 1rem; background: #fff8f2; }
    h2 { color: #ff914d; }
    .card { background: white; padding: 1rem; margin: 1rem 0; border-radius: 1rem; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    input, textarea, select { width: 100%; margin-top: 5px; margin-bottom: 10px; padding: 8px; border-radius: 6px; border: 1px solid #ccc; }
    button { background: #ff914d; color: white; padding: 10px; border: none; border-radius: 5px; cursor: pointer; }
    .logout { float: right; background: #c62828; margin-top: -40px; }
  </style>
</head>
<body>

  <h2>Owner Panel - Dapur Kana</h2>
  <button class="logout" onclick="logout()">Logout</button>

  <div id="login-form" class="card">
    <h3>Login Admin</h3>
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button onclick="login()">Login</button>
  </div>

  <div id="admin-panel" style="display: none;">
    <div class="card">
      <h3>Tambah / Edit Menu</h3>
      <input type="hidden" id="id" />
      <input type="text" id="nama" placeholder="Nama Menu" />
      <input type="number" id="harga" placeholder="Harga (Rp)" />
      <input type="text" id="kategori" placeholder="Kategori (contoh: minuman, makanan)" />
      <textarea id="deskripsi" placeholder="Deskripsi menu..."></textarea>
      <input type="file" id="gambar" />
      <button onclick="simpanMenu()">Simpan</button>
    </div>

    <div class="card">
      <h3>Daftar Menu</h3>
      <div id="menu-list"></div>
    </div>
  </div>

  <script>
        const supabaseUrl = 'https://qcevidnjbsyjfdwfduiz.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjZXZpZG5qYnN5amZkd2ZkdWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwMzcwODksImV4cCI6MjA2ODYxMzA4OX0.bR-FZBvVbY7njHKvI_lA0GPs4TaHQKq8YzX2a-dJ3JI';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    async function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const { error, user, session } = await supabase.auth.signInWithPassword({ email, password });
      if (error) return alert(error.message);
      if (email !== 'oishidzato@gmail.com') {
        alert("Bukan akun owner");
        await supabase.auth.signOut();
        return;
      }
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('admin-panel').style.display = 'block';
      loadMenu();
    }

    async function logout() {
      await supabase.auth.signOut();
      location.reload();
    }

    async function loadMenu() {
      const { data, error } = await supabase.from('menu').select('*').order('nama');
      const container = document.getElementById('menu-list');
      container.innerHTML = '';
      data.forEach(item => {
        const div = document.createElement('div');
        div.innerHTML = `
          <strong>${item.nama}</strong><br>
          Rp ${item.harga} - ${item.kategori}<br>
          <small>${item.deskripsi}</small><br>
          <img src="${item.gambar_url}" width="100"><br>
          <button onclick='editMenu(${JSON.stringify(item)})'>Edit</button>
          <button onclick='hapusMenu("${item.id}")'>Hapus</button>
          <hr>
        `;
        container.appendChild(div);
      });
    }

    async function simpanMenu() {
      const id = document.getElementById('id').value;
      const nama = document.getElementById('nama').value;
      const harga = parseInt(document.getElementById('harga').value);
      const kategori = document.getElementById('kategori').value;
      const deskripsi = document.getElementById('deskripsi').value;
      const gambarInput = document.getElementById('gambar');
      let gambar_url = null;

      if (gambarInput.files.length > 0) {
        const file = gambarInput.files[0];
        const { data, error } = await supabase.storage.from('images').upload(`menu/${Date.now()}-${file.name}`, file);
        if (error) {
          alert("Gagal upload gambar: " + error.message);
          return;
        }
        gambar_url = supabase.storage.from('images').getPublicUrl(data.path).data.publicUrl;
      }

      if (id) {
        // Update
        const updateData = { nama, harga, kategori, deskripsi };
        if (gambar_url) updateData.gambar_url = gambar_url;
        await supabase.from('menu').update(updateData).eq('id', id);
      } else {
        // Tambah
        await supabase.from('menu').insert([{ nama, harga, kategori, deskripsi, gambar_url }]);
      }

      document.getElementById('id').value = '';
      document.getElementById('nama').value = '';
      document.getElementById('harga').value = '';
      document.getElementById('kategori').value = '';
      document.getElementById('deskripsi').value = '';
      gambarInput.value = '';
      loadMenu();
    }

    function editMenu(item) {
      document.getElementById('id').value = item.id;
      document.getElementById('nama').value = item.nama;
      document.getElementById('harga').value = item.harga;
      document.getElementById('kategori').value = item.kategori;
      document.getElementById('deskripsi').value = item.deskripsi;
    }

    async function hapusMenu(id) {
      if (confirm('Yakin ingin menghapus menu ini?')) {
        await supabase.from('menu').delete().eq('id', id);
        loadMenu();
      }
    }
  </script>

</body>
</html>