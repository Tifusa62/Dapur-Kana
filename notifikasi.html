<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Notifikasi - Dapur Kana</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <header>
    <h1>📢 Notifikasi Pesanan</h1>
    <nav>
      <a href="index.html">Beranda</a>
      <a href="menu.html">Menu</a>
      <a href="checkout.html">Keranjang</a>
    </nav>
  </header>

  <main style="padding: 1rem;">
    <div id="notifList">
      <p>Memuat notifikasi...</p>
    </div>
  </main>

  <footer>
    <p>© 2025 Dapur Kana</p>
  </footer>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js'

    const supabaseUrl = 'https://qcevidnjbsyjfdwfduiz.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjZXZpZG5qYnN5amZkd2ZkdWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwMzcwODksImV4cCI6MjA2ODYxMzA4OX0.bR-FZBvVbY7njHKvI_lA0GPs4TaHQKq8YzX2a-dJ3JI'; // gunakan key kamu
    const supabase = createClient(supabaseUrl, supabaseKey)

    const notifList = document.getElementById("notifList");

    async function loadNotifikasi() {
      const { data, error } = await supabase
        .from('pesanan')
        .select('*')
        .order('waktu', { ascending: false });

      if (error) {
        notifList.innerHTML = `<p style="color:red;">Gagal memuat notifikasi: ${error.message}</p>`;
        return;
      }

      if (data.length === 0) {
        notifList.innerHTML = "<p>Belum ada pesanan masuk.</p>";
        return;
      }

      notifList.innerHTML = "";
      data.forEach(pesan => {
        const div = document.createElement("div");
        div.className = "menu-card"; // gunakan styling kartu dari CSS yang sama
        const tanggal = new Date(pesan.waktu).toLocaleString();

        const itemsList = pesan.items.map(item => `
          <li>${item.nama} x${item.qty} - Rp ${item.harga * item.qty}</li>
        `).join("");

        div.innerHTML = `
          <h3>👤 ${pesan.nama}</h3>
          <p>📞 ${pesan.no_hp}</p>
          <p>📍 ${pesan.alamat}</p>
          <p>🕒 ${tanggal}</p>
          <ul>${itemsList}</ul>
          <p>💳 Pembayaran: <strong>${pesan.metode}</strong></p>
          <p>Total: <strong>Rp ${pesan.total.toLocaleString()}</strong></p>
          <p>Status: <em>${pesan.status || 'Menunggu'}</em></p>
        `;
        notifList.appendChild(div);
      });
    }

    loadNotifikasi();
  </script>
</body>
</html>
