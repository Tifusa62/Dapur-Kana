<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Owner Panel - Dapur Kana</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #00cfd3;
      color: #fff;
    }
    header {
      background-color: #004d4d;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 20px;
    }
    .brand {
      font-family: 'Georgia', serif;
      font-size: 24px;
      font-weight: bold;
    }
    .hamburger {
      font-size: 28px;
      cursor: pointer;
      background: none;
      border: none;
      color: white;
    }
    .sidebar {
      position: fixed;
      top: 0;
      left: -250px;
      height: 100%;
      width: 250px;
      background: #004d4d;
      padding-top: 60px;
      transition: left 0.3s ease;
      z-index: 100;
    }
    .sidebar a {
      display: block;
      padding: 14px 20px;
      color: white;
      text-decoration: none;
      font-weight: bold;
    }
    .sidebar a:hover {
      background: #007979;
    }
    main {
      padding: 20px;
    }
    .hidden {
      display: none;
    }
    input, textarea, button {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      border-radius: 20px;
      border: none;
      font-size: 16px;
    }
    button {
      background: #004d4d;
      color: white;
      cursor: pointer;
    }
    .upload-area {
      width: 100%;
      max-width: 300px;
      height: 150px;
      background: #004d4d;
      border-radius: 1rem;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      margin: 10px 0;
    }
    .menu-item {
      background: #007979;
      padding: 10px;
      border-radius: 12px;
      margin: 10px 0;
    }
    img {
      max-width: 100px;
      border-radius: 1rem;
      margin-top: 8px;
    }
    h2 {
      text-align: center;
      font-family: Georgia, serif;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div id="sidebar" class="sidebar">
    <a href="#" onclick="showSection('laporan')">üìä Laporan</a>
    <a href="#" onclick="showSection('editMenu')">üçî Edit Menu</a>
    <a href="#" onclick="showSection('editBanner')">üñºÔ∏è Edit Banners</a>
    <a href="#" onclick="logout()">üö™ Logout</a>
  </div>

  <!-- Header -->
  <header>
    <button class="hamburger" onclick="toggleSidebar()">‚ò∞</button>
    <div class="brand">Owner panel</div>
  </header>

  <!-- Login -->
  <main>
    <section id="loginSection">
      <h2>Login Owner</h2>
      <form id="loginForm">
        <input type="email" id="email" placeholder="Email" required />
        <input type="password" id="password" placeholder="Password" required />
        <button type="submit">Login</button>
      </form>
    </section>

    <!-- Laporan -->
    <section id="laporan" class="hidden">
      <h2>Laporan Penjualan</h2>
      <canvas id="chart1"></canvas>
      <canvas id="chart2"></canvas>
    </section>

    <!-- Edit Menu -->
    <section id="editMenu" class="hidden">
      <h2>Edit Menu</h2>
      <form id="menuForm">
        <input type="hidden" id="menuId" />
        <input type="text" id="nama" placeholder="Nama Menu" required />
        <input type="number" id="harga" placeholder="Harga" required />
        <input type="text" id="kategori" placeholder="Kategori" required />
        <textarea id="deskripsi" placeholder="Deskripsi"></textarea>
        <input type="file" id="gambar" />
        <button type="submit">Simpan Menu</button>
      </form>
      <div id="menuList"></div>
    </section>

    <!-- Edit Banners -->
    <section id="editBanner" class="hidden">
      <h2>Edit Banners</h2>
      <input type="file" id="bannerUpload" />
      <button onclick="uploadBanner()">Upload Banner</button>
      <div id="bannerList"></div>
    </section>
  </main>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabaseUrl = 'https://qcevidnjbsyjfdwfduiz.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjZXZpZG5qYnN5amZkd2ZkdWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwMzcwODksImV4cCI6MjA2ODYxMzA4OX0.bR-FZBvVbY7njHKvI_lA0GPs4TaHQKq8YzX2a-dJ3JI'; // Potong untuk keamanan
    const supabase = createClient(supabaseUrl, supabaseKey);

    // Sidebar
    window.toggleSidebar = () => {
      const sidebar = document.getElementById("sidebar");
      sidebar.style.left = sidebar.style.left === "0px" ? "-250px" : "0px";
    }

    // Navigasi antar section
    window.showSection = (id) => {
      document.querySelectorAll("main section").forEach(s => s.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
      toggleSidebar();
    }

    // Login
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      const { data, error } = await supabase.auth.signInWithPassword({ email, password });
      if (error || data.user.email !== "oishidzato@gmail.com") return alert("Login gagal!");

      document.getElementById("loginSection").classList.add("hidden");
      document.getElementById("laporan").classList.remove("hidden");
      renderCharts();
      loadMenu();
      loadBannerList();
    });

    // Logout
    window.logout = async () => {
      await supabase.auth.signOut();
      location.reload();
    }

    // Chart dummy
    function renderCharts() {
      new Chart(document.getElementById("chart1"), {
        type: "bar",
        data: {
          labels: ["01/01", "02/01", "03/01", "04/01"],
          datasets: [{ label: "Penjualan", data: [10, 20, 30, 40], backgroundColor: "#009999" }]
        }
      });
      new Chart(document.getElementById("chart2"), {
        type: "horizontalBar",
        data: {
          labels: ["01/01", "02/01", "03/01", "04/01"],
          datasets: [{ label: "Order", data: [5, 15, 25, 10], backgroundColor: "#33cccc" }]
        }
      });
    }

    // Load Menu
    async function loadMenu() {
      const { data } = await supabase.from("menu").select("*").order("nama");
      const list = document.getElementById("menuList");
      list.innerHTML = "";
      data.forEach(item => {
        const div = document.createElement("div");
        div.className = "menu-item";
        div.innerHTML = `
          <strong>${item.nama}</strong> - Rp${item.harga}<br/>
          <img src="${item.gambar_url}" />
          <button onclick='editMenu(${JSON.stringify(item)})'>Edit</button>
          <button onclick='hapusMenu("${item.id}")'>Hapus</button>
        `;
        list.appendChild(div);
      });
    }

    // Submit Menu
    document.getElementById("menuForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = document.getElementById("menuId").value;
      const nama = document.getElementById("nama").value;
      const harga = parseInt(document.getElementById("harga").value);
      const kategori = document.getElementById("kategori").value;
      const deskripsi = document.getElementById("deskripsi").value;
      const gambar = document.getElementById("gambar").files[0];

      let gambar_url = "";
      if (gambar) {
        const path = `${Date.now()}-${gambar.name}`;
        await supabase.storage.from("gambar-menu").upload(path, gambar);
        const { data } = supabase.storage.from("gambar-menu").getPublicUrl(path);
        gambar_url = data.publicUrl;
      }

      const payload = { nama, harga, kategori, deskripsi, ...(gambar_url && { gambar_url }) };

      if (id) await supabase.from("menu").update(payload).eq("id", id);
      else await supabase.from("menu").insert(payload);

      e.target.reset();
      loadMenu();
    });

    window.editMenu = (item) => {
      document.getElementById("menuId").value = item.id;
      document.getElementById("nama").value = item.nama;
      document.getElementById("harga").value = item.harga;
      document.getElementById("kategori").value = item.kategori;
      document.getElementById("deskripsi").value = item.deskripsi;
    }

    window.hapusMenu = async (id) => {
      if (confirm("Hapus menu ini?")) {
        await supabase.from("menu").delete().eq("id", id);
        loadMenu();
      }
    }

    // Banner
    window.uploadBanner = async () => {
      const file = document.getElementById("bannerUpload").files[0];
      if (!file) return alert("Pilih gambar dulu");
      const path = `${Date.now()}-${file.name}`;
      await supabase.storage.from("banner").upload(path, file);
      const { data } = supabase.storage.from("banner").getPublicUrl(path);
      await supabase.from("banners").insert({ url: data.publicUrl });
      loadBannerList();
    }

    async function loadBannerList() {
      const { data } = await supabase.from("banners").select("*");
      const list = document.getElementById("bannerList");
      list.innerHTML = "";
      data.forEach(item => {
        const div = document.createElement("div");
        div.innerHTML = `<img src="${item.url}" /><br/>
        <button onclick="deleteBanner(${item.id}, '${item.url}')">Hapus</button>`;
        list.appendChild(div);
      });
    }

    window.deleteBanner = async (id, url) => {
      const file = url.split("/").pop().split("?")[0];
      await supabase.storage.from("banner").remove([file]);
      await supabase.from("banners").delete().eq("id", id);
      loadBannerList();
    }
  </script>
</body>
</html>
