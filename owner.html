<!DOCTYPE html><html>
<head>
  <title>Owner - Dapur Kana</title>
  <meta charset="UTF-8" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
  <nav>
    <a href="index.html">Beranda</a> |
    <a href="menu.html">Menu</a> |
    <a href="checkout.html">Keranjang</a> |
    <a href="notifikasi.html">Notifikasi</a> |
    <a href="owner.html">Owner</a>
  </nav>  <section id="loginSection">
    <h2>Login Owner</h2>
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Password" required />
    <button id="loginBtn">Login</button>
  </section>  <section id="dashboard" style="display:none;">
    <h2>Kelola Menu</h2>
    <form id="menuForm">
      <input type="hidden" id="menuId" />
      <input type="text" id="nama" placeholder="Nama Menu" required />
      <input type="number" id="harga" placeholder="Harga" required />
      <input type="text" id="kategori" placeholder="Kategori" required />
      <textarea id="deskripsi" placeholder="Deskripsi" required></textarea>
      <input type="file" id="gambar" accept="image/*" />
      <button type="submit">Simpan Menu</button>
    </form>
    <div id="menuList"></div>
  </section>  <script>
    const supabase = supabase.createClient("https://qcevidnjbsyjfdwfduiz.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjZXZpZG5qYnN5amZkd2ZkdWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwMzcwODksImV4cCI6MjA2ODYxMzA4OX0.bR-FZBvVbY7njHKvI_lA0GPs4TaHQKq8YzX2a-dJ3JI");

    const loginSection = document.getElementById("loginSection");
    const dashboard = document.getElementById("dashboard");
    const menuList = document.getElementById("menuList");

    document.getElementById("loginBtn").addEventListener("click", async () => {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      const { data, error } = await supabase.auth.signInWithPassword({ email, password });

      if (error) return alert("Login gagal: " + error.message);
      if (data.user.email === "oishidzato@gmail.com") {
        loginSection.style.display = "none";
        dashboard.style.display = "block";
        loadMenu();
      } else {
        alert("Hanya owner yang bisa login.");
      }
    });

    document.getElementById("menuForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = document.getElementById("menuId").value;
      const nama = document.getElementById("nama").value;
      const harga = parseInt(document.getElementById("harga").value);
      const kategori = document.getElementById("kategori").value;
      const deskripsi = document.getElementById("deskripsi").value;
      const file = document.getElementById("gambar").files[0];
      let gambar_url = "";

      if (file) {
        const { data, error } = await supabase.storage.from("gambar-menu").upload(`menu/${Date.now()}_${file.name}`, file);
        if (error) return alert("Upload gambar gagal: " + error.message);
        const { data: urlData } = supabase.storage.from("gambar-menu").getPublicUrl(data.path);
        gambar_url = urlData.publicUrl;
      }

      if (id) {
        await supabase.from("menu").update({ nama, harga, kategori, deskripsi, gambar_url }).eq("id", id);
      } else {
        await supabase.from("menu").insert({ nama, harga, kategori, deskripsi, gambar_url });
      }
      document.getElementById("menuForm").reset();
      loadMenu();
    });

    async function loadMenu() {
      const { data, error } = await supabase.from("menu").select("*").order("nama", { ascending: true });
      menuList.innerHTML = "";
      if (error) {
        console.error("Gagal load menu:", error.message);
        return;
      }

      data.forEach(item => {
        const div = document.createElement("div");
        div.innerHTML = `
          <hr />
          <p><strong>${item.nama}</strong> (Rp ${item.harga})</p>
          ${item.gambar_url ? `<img src="${item.gambar_url}" width="100" />` : ""}
          <button onclick='editMenu(${JSON.stringify(item)})'>Edit</button>
          <button onclick='hapusMenu("${item.id}")'>Hapus</button>
        `;
        menuList.appendChild(div);
      });
    }

    window.editMenu = (item) => {
      document.getElementById("menuId").value = item.id;
      document.getElementById("nama").value = item.nama;
      document.getElementById("harga").value = item.harga;
      document.getElementById("kategori").value = item.kategori;
      document.getElementById("deskripsi").value = item.deskripsi;
    }

    window.hapusMenu = async (id) => {
      if (confirm("Hapus menu ini?")) {
        await supabase.from("menu").delete().eq("id", id);
        loadMenu();
      }
    }

    (async () => {
      const { data } = await supabase.auth.getSession();
      const user = data.session?.user;
      if (user && user.email === "oishidzato@gmail.com") {
        loginSection.style.display = "none";
        dashboard.style.display = "block";
        loadMenu();
      }
    })();
  </script></body>
</html>
