<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Owner - Dapur Kana</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>Owner Panel</h1>
  <nav>
  <a href="index.html">Beranda</a> |
  <a href="menu.html">Menu</a> |
  <a href="checkout.html">Keranjang</a> |
  <a href="notifikasi.html">Notifikasi</a> |
  <a href="owner.html">Owner</a>
</nav>

  <section id="loginSection">
    <h2>Login</h2>
    <form id="loginForm">
      <input type="email" id="email" placeholder="Email" required />
      <input type="password" id="password" placeholder="Password" required />
      <button type="submit">Login</button>
    </form>
  </section>

  <section id="dashboard" style="display:none;">
    <h2>Kelola Menu</h2>
    <form id="menuForm">
      <input type="hidden" id="menuId" />
      <input type="text" id="nama" placeholder="Nama Menu" required />
      <input type="number" id="harga" placeholder="Harga" required />
      <input type="text" id="kategori" placeholder="Kategori" required />
      <textarea id="deskripsi" placeholder="Deskripsi" required></textarea>
      <input type="file" id="gambar" accept="image/*" />
      <button type="submit">Simpan Menu</button>
    </form>
    <div id="menuList"></div>
  </section>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js"

    const supabaseUrl = "https://qcevidnjbsyjfdwfduiz.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjZXZpZG5qYnN5amZkd2ZkdWl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMwMzcwODksImV4cCI6MjA2ODYxMzA4OX0.bR-FZBvVbY7njHKvI_lA0GPs4TaHQKq8YzX2a-dJ3JI"; // Ganti dengan anon key kamu
    const supabase = createClient(supabaseUrl, supabaseKey);

    const loginSection = document.getElementById("loginSection");
    const dashboard = document.getElementById("dashboard");
    const menuForm = document.getElementById("menuForm");
    const menuList = document.getElementById("menuList");

    // Login handler
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      const { data, error } = await supabase.auth.signInWithPassword({ email, password });

      if (error) {
        alert("Login gagal: " + error.message);
        return;
      }

      if (data.user.email === "oishidzato@gmail.com") {
        loginSection.style.display = "none";
        dashboard.style.display = "block";
        loadMenu();
      } else {
        alert("Bukan akun owner!");
      }
    });

    // Auto login jika sesi masih ada
    (async () => {
      const { data } = await supabase.auth.getSession();
      const user = data.session?.user;
      if (user && user.email === "oishidzato@gmail.com") {
        loginSection.style.display = "none";
        dashboard.style.display = "block";
        loadMenu();
      }
    })();
    <h2>Kelola Banner</h2>

<!-- Form Upload -->
<input type="file" id="bannerUpload" />
<button onclick="uploadBanner()">Upload Banner</button>

<!-- Daftar Banner -->
<div id="bannerList" style="margin-top: 1rem;"></div>

  // Upload banner
  async function uploadBanner() {
    const fileInput = document.getElementById('bannerUpload')
    const file = fileInput.files[0]
    if (!file) return alert('Pilih gambar terlebih dahulu.')

    const fileName = `${Date.now()}_${file.name}`
    const { data, error } = await supabase.storage
      .from('banner')
      .upload(fileName, file)

    if (error) {
      alert('Gagal upload banner:', error.message)
      return
    }

    const { publicUrl } = supabase.storage
      .from('banner')
      .getPublicUrl(fileName)

    const insert = await supabase
      .from('banner')
      .insert([{ url: publicUrl }])

    if (insert.error) {
      alert('Gagal simpan banner:', insert.error.message)
    } else {
      alert('Banner berhasil diupload!')
      loadBannerList()
    }
  }

  // Tampilkan banner
  async function loadBannerList() {
    const container = document.getElementById('bannerList')
    container.innerHTML = 'Memuat...'

    const { data, error } = await supabase
      .from('banner')
      .select('*')
      .order('created_at', { ascending: false })

    if (error) {
      container.innerHTML = 'Gagal memuat banner.'
      return
    }

    if (data.length === 0) {
      container.innerHTML = 'Belum ada banner.'
      return
    }

    container.innerHTML = ''
    data.forEach(item => {
      const div = document.createElement('div')
      div.style.marginBottom = '1rem'

      const img = document.createElement('img')
      img.src = item.url
      img.style.width = '100%'
      img.style.maxWidth = '300px'
      img.style.borderRadius = '1rem'

      const btn = document.createElement('button')
      btn.textContent = 'Hapus'
      btn.style.marginTop = '0.5rem'
      btn.onclick = () => deleteBanner(item.id, item.url)

      div.appendChild(img)
      div.appendChild(document.createElement('br'))
      div.appendChild(btn)

      container.appendChild(div)
    })
  }

  // Hapus banner
  async function deleteBanner(id, url) {
    const path = url.split('/').pop().split('?')[0]
    const del = await supabase.storage.from('banner').remove([path])
    const { error } = await supabase.from('banner').delete().eq('id', id)

    if (error || del.error) {
      alert('Gagal menghapus banner.')
    } else {
      alert('Banner berhasil dihapus.')
      loadBannerList()
    }
  }
loadBannerList()
    // Submit form menu
    menuForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      const id = document.getElementById("menuId").value;
      const nama = document.getElementById("nama").value;
      const harga = parseInt(document.getElementById("harga").value);
      const kategori = document.getElementById("kategori").value;
      const deskripsi = document.getElementById("deskripsi").value;
      const gambarInput = document.getElementById("gambar");
      let gambar_url = "";

      if (gambarInput.files.length > 0) {
        const file = gambarInput.files[0];
        const fileName = `${Date.now()}-${file.name}`;
        const { data: uploadData, error: uploadError } = await supabase.storage
          .from("gambar-menu")
          .upload(fileName, file);

        if (uploadError) {
          alert("Gagal upload gambar: " + uploadError.message);
          return;
        }

        const { data: publicURL } = supabase.storage
          .from("gambar-menu")
          .getPublicUrl(fileName);

        gambar_url = publicURL.publicUrl;
      }

      let result;
      if (id) {
        result = await supabase.from("menu").update({
          nama, harga, kategori, deskripsi,
          ...(gambar_url && { gambar_url })
        }).eq("id", id);
      } else {
        result = await supabase.from("menu").insert({
          nama, harga, kategori, deskripsi, gambar_url
        });
      }

      if (result.error) {
        alert("Gagal simpan: " + result.error.message);
        return;
      }

      menuForm.reset();
      document.getElementById("menuId").value = "";
      loadMenu();
    });

    async function loadMenu() {
      const { data, error } = await supabase.from("menu").select("*").order("nama", { ascending: true });
      menuList.innerHTML = "";

      if (error) {
        console.error("Gagal load menu:", error.message);
        return;
      }

      data.forEach(item => {
        const div = document.createElement("div");
        div.innerHTML = `
          <hr />
          <p><strong>${item.nama}</strong> (Rp ${item.harga})</p>
          ${item.gambar_url ? `<img src="${item.gambar_url}" width="100" />` : ""}
          <button onclick='editMenu(${JSON.stringify(item)})'>Edit</button>
          <button onclick='hapusMenu("${item.id}")'>Hapus</button>
        `;
        menuList.appendChild(div);
      });
    }

    window.editMenu = (item) => {
      document.getElementById("menuId").value = item.id;
      document.getElementById("nama").value = item.nama;
      document.getElementById("harga").value = item.harga;
      document.getElementById("kategori").value = item.kategori;
      document.getElementById("deskripsi").value = item.deskripsi;
    }

    window.hapusMenu = async (id) => {
      if (confirm("Hapus menu ini?")) {
        await supabase.from("menu").delete().eq("id", id);
        loadMenu();
      }
    }
  </script>
</body>
</html>
